# Documentation for standard installation of MongoDB and CVE-Search in Windows Subsytem for Linux

cve-search is a tool to import CVE (Common Vulnerabilities and Exposures) and CPE (Common Platform Enumeration) into a MongoDB to facilitate search and processing of CVEs.

This document gives you complemete guide to execute the CVE-search in **Windows**.

## Install Windows Subsystem for Linux (WSL)

**Step 1:** Install WSL Ubuntu version 20.04 or version 18.04 from Microsoft Store or you can use commands to install as well.

**Step 2:** Open Ubuntu app just downloaded and create username and password

**Step 3:** Open Microsoft Powershell in administration mode and follow the bellow commands:
		
		> wsl --set-default-version 2
		
		The above command sets the default version to wsl 2, which has additonal features than the initial version. 
		In case, if it is not installed, you might need to update using the instructions provided by the output and run this command again.
				
		> wsl -l -v
		
		This command check what version the wsl is currently running. 

		> wsl --set-version Ubuntu-18.04 2
		
		This command is required only if the default version is not same as the current version installed.
		This command sets the wsl version of ubuntu-18.04 distribution to 2. In case if you are using WSL for other distributions, replace it accordingly.


## Run commands in WSL (in administration mode) to install MongoDB and CVE-Search

**Step 4:** Open WSL Ubuntu or Windows powershell and use commands to go to WSL

**Step 5:** Follow below commands to update WSL and other neccessities:

		>  sudo apt update && sudo apt -y upgrade
		
**Step 6:** This step is <Optional> as it creates a light weight desktop environment using xrdp and xcfe

		
		>  sudo apt-get purge xrdp
		>  sudo apt install -y xrdp
		>  sudo apt install -y xfce4
		>  sudo apt install -y xfce4-goodies
		>  sudo apt-get update -y xfce4-goodies
		>  sudo apt-get update
		>  sudo apt install -y xfce4-goodies
		>  sudo cp /etc/xrdp/xrdp.ini /etc/xrdp/xrdp.ini.bak
		>  sudo sed -i 's/3389/3390/g' /etc/xrdp/xrdp.ini
		>  sudo sed -i 's/max_bpp=32/#max_bpp=32\nmax_bpp=128/g' /etc/xrdp/xrdp.ini
		>  sudo sed -i 's/xserverbpp=24/#xserverbpp=24\nxserverbpp=128/g' /etc/xrdp/xrdp.ini
		>  echo xfce4-session > ~/.xsession
		
		You can use below command to start using remote desktop connection.
		
		> sudo /etc/init.d/xrdp start
		
		you can refer the attached video in references for connecting to a remote desktop.
		

**Step 7:** Copy contents from Windows to WSL file system using file explorer. <br>
		1. Clone [CVE-Search repository](https://github.com/cve-search/cve-search) into local windows machine using github. <br>
		2. Copy and paste the repository in the path /home/<username>/ in WSL file system using the file explorer. <br>
		

**Step 8:** Install Python

		> sudo apt-get install python3
	
**Step 9:** Go to cve-search repository directory and install the requirements.
		
		> cd /home/<username>/cve-search/
		> xargs sudo apt-get install -y < requirements.system
		> pip3 install -r requirements.txt
		> sudo apt-get install redis-server
		> sudo service redis-server start
		> sudo service redis-server status
		> netstat -an | grep 6379
		

**Step 10:** Run the below commands incase if you tried to install MongoDB and it got failed
		
		> sudo apt-get purge mongodb-org*
		> sudo rm -r /var/log/mongodb
		> sudo rm -r /var/lib/mongodb
		> sudo apt remove mongodb
		> sudo apt purge mongodb
		> sudo apt autoremove
		
**Step 11:** Install MongoDB

		> wget -qO - https://www.mongodb.org/static/pgp/server-5.0.asc | sudo apt-key add -
		> sudo apt-get install gnupg
		> wget -qO - https://www.mongodb.org/static/pgp/server-5.0.asc | sudo apt-key add -
		> echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/5.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-5.0.list
		> sudo apt-get update
		> sudo apt-get install -y mongodb-org
		> echo "mongodb-org hold" | sudo dpkg --set-selections
		> echo "mongodb-org-database hold" | sudo dpkg --set-selections
		> echo "mongodb-org-server hold" | sudo dpkg --set-selections
		> echo "mongodb-org-shell hold" | sudo dpkg --set-selections
		> echo "mongodb-org-mongos hold" | sudo dpkg --set-selections
		> echo "mongodb-org-tools hold" | sudo dpkg --set-selections
		> mongo --version
		> curl https://raw.githubusercontent.com/mongodb/mongo/master/debian/init.d | sudo tee /etc/init.d/mongodb >/dev/null
		> sudo chmod +x /etc/init.d/mongodb
	
		After the above commands are successful, the mongodb should be installed. You can start the MongoDB server and check the status using below commands.
		
		> sudo service mongodb start
		> sudo service mongodb status
		> netstat -an | grep 27017
		
		

## Populating the database using cve-search

**Step 12**: Make sure the above steps are all completed and both MongoDB and Redis databases are running before running the below commands.

		> ./sbin/db_mgmt_cpe_dictionary.py -p
		> ./sbin/db_mgmt_json.py -p
		> ./sbin/db_updater.py -c # This will take >45minutes on a decent machine, please be patient
		
		If you want to add the cross-references from NIST, Red Hat and other vendors thanks to VIA4CVE:

		> ./sbin/db_mgmt_ref.py
		
		NB: If you want to import your own JSON from VIA4CVE, you have to replace URL in sources.ini the VIA4 attribute with file:///PATH/TO/VIA4CVE/VIA4CVE-feed.json.
		

## Updating the database or repopulate the database

**Steps 13 and 14 can be executed for future use cases**		

**Step 13:** Updating the database
		
		 An updater script helps to start the db_mgmt_*

		> ./sbin/db_updater.py -v
		
		You can run it in a crontab, logging is done in log/update_populate.log by default.

**Step 14:** Repopulating the database
		
		 To easily drop and re-populate all the databases

		> ./sbin/db_updater.py -v -f
		
		This will drop all the existing external sources and reimport everything. This operation can take some time and itâ€™s usually only required when new attributes parsing are added in cve-search.
		
		
## References

[Watch this youtube video for WSL 2 and remote desktop connection guide](https://www.youtube.com/watch?v=J4Giu5iWigQ&t=408s&ab_channel=Britec09) <br>

[Watch this youtube video for CVE-Search installation on Ubuntu-18.04](https://www.youtube.com/watch?v=5fRXFPKPzaw&t=28s&ab_channel=Roland) <br>
	
[WSL mongodb installation tutorial](https://docs.microsoft.com/en-us/windows/wsl/tutorials/wsl-database)



